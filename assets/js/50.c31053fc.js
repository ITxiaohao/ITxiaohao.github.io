(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{429:function(t,s,n){"use strict";n.r(s);var a=n(2),r=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("Proxy 是 ES6 中新增的功能，可以理解成，在目标对象之前架设一层 "),n("strong",[t._v("「拦截」")]),t._v("，外界对该对象的访问，都必须先通过这层"),n("strong",[t._v("拦截")]),t._v("，因此提供了一种机制，可以对外界的访问进行"),n("strong",[t._v("过滤")]),t._v("和"),n("strong",[t._v("改写")]),t._v("。")]),t._v(" "),n("p",[t._v("Proxy 这个词的原意是代理，用在这里表示由它来 "),n("strong",[t._v("「代理」")]),t._v(" 某些操作，可以译为 "),n("strong",[t._v("「代理器」")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`getting ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("!`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Reflect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`setting ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("!`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Reflect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nobj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  setting count!")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  getting count!")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  setting count!")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  getting count!")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  2")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110725.png",alt:""}})]),t._v(" "),n("p",[t._v("往下走")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110743.png",alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110754.png",alt:""}})]),t._v(" "),n("p",[n("strong",[t._v("key")]),t._v(" 表示的是要进行设置的属性")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110805.png",alt:""}})]),t._v(" "),n("p",[n("strong",[t._v("value")]),t._v(" 表示要设置的值")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110816.png",alt:""}})]),t._v(" "),n("p",[n("strong",[t._v("receiver")]),t._v(" 将 "),n("strong",[t._v("count: 1")]),t._v(" 设置到 "),n("strong",[t._v("Proxy")]),t._v(" 对象中")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110831.png",alt:""}})]),t._v(" "),n("p",[t._v("之后运行 "),n("code",[t._v("++obj.count")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110854.png",alt:""}})]),t._v(" "),n("p",[t._v("要运行 "),n("strong",[t._v("++")]),t._v(" 之前，先要"),n("strong",[t._v("读取")]),t._v("到 "),n("strong",[t._v("obj.count")]),t._v(" 属性的值，所以这里触发了 "),n("strong",[t._v("get")]),t._v(" 方法")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110934.png",alt:""}})]),t._v(" "),n("p",[t._v("这时的 "),n("strong",[t._v("target")]),t._v(" 目标对象中，"),n("strong",[t._v("count")]),t._v(" 的属性值为 "),n("strong",[t._v("1")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123110956.png",alt:""}})]),t._v(" "),n("p",[t._v("get 方法"),n("strong",[t._v("读取")]),t._v("到 count 的值之后，就执行 "),n("strong",[t._v("++")]),t._v(" 操作，就触发了 set 方法，同时可以发现，在 set 方法里的 value 参数从 1 变为了 2")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111023.png",alt:""}})]),t._v(" "),n("p",[t._v("往后走，到了 console.log ，输出 obj.count 的值，这时就触发了 get 方法，"),n("strong",[t._v("只要读取值就会被 get 方法代理拦截")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111048.png",alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111058.png",alt:""}})]),t._v(" "),n("p",[t._v("这就是一个简单的 Proxy 代理器，上面的代码对一个空对象架设了一层拦截，重定义了属性的读取（get）和设置（set）行为，ES6 原生提供 Proxy 构造函数，用来生成 Proxy 实例。")]),t._v(" "),n("p",[n("code",[t._v("var proxy = new Proxy(target, handler);")])]),t._v(" "),n("p",[t._v("Proxy 对象的所有用法，都是上面这种形式，不同的只是 handler 参数的写法。")]),t._v(" "),n("p",[t._v("其中，"),n("strong",[t._v("new Proxy()")]),t._v(" 表示生成一个 Proxy 实例，"),n("strong",[t._v("target")]),t._v(" 参数表示所要拦截的"),n("strong",[t._v("目标对象")]),t._v("，"),n("strong",[t._v("handler")]),t._v(" 参数也是一个对象，用来"),n("strong",[t._v("定制拦截行为")]),t._v("。")]),t._v(" "),n("p",[t._v("下面是一个拦截读取属性的例子")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111111.png",alt:""}})]),t._v(" "),n("p",[t._v("这里我们在 get 方法中全部返回 35")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111124.png",alt:""}})]),t._v(" "),n("blockquote",[n("p",[t._v("只要是访问 proxy 对象下的属性，都会触发 get 方法拦截")])]),t._v(" "),n("p",[t._v("所以这里访问 proxy 下的任何属性全部返回 35")]),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[t._v("注意，要使得 Proxy 起作用，必须针对 Proxy 实例（上例是 proxy 对象）进行操作，而不是针对目标对象（上例是空对象）进行操作。")]),t._v(" "),n("p",[t._v("如果 handler 没有设置任何拦截，那就等同于直接通向原对象。")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/ITxiaohao/blog-img/master/img/designMode/20190123111138.png",alt:""}})]),t._v(" "),n("p",[t._v("上面代码中，"),n("strong",[t._v("handler 是一个空对象，没有任何拦截效果")]),t._v("，访问 proxy 就等同于访问 target")]),t._v(" "),n("p",[t._v("一个技巧是将 Proxy 对象，设置到 object.proxy 属性，从而可以在 object 对象上调用")]),t._v(" "),n("p",[t._v("具体详情看 "),n("a",{attrs:{href:"https://es6.ruanyifeng.com/#docs/proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("ES6 入门"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("如果要实现一个 Vue 中的响应式，还要在 get 中做"),n("strong",[t._v("收集依赖")]),t._v("，在 set 里"),n("strong",[t._v("派发更新")])]),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",[n("strong",[t._v("proxy")]),t._v(" 可以监听到任何方式的数据改变，唯一缺陷可能就是浏览器的 "),n("strong",[t._v("兼容性")]),t._v(" 不好了")])])])},[],!1,null,null,null);s.default=r.exports}}]);